import{store as e,getContext as t,getElement as o,getConfig as r,withScope as E}from"@wordpress/interactivity";let{fn:{execute:l,validateConfig:a},Events:n}=wecodeart,NAME="counter",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_START=`start${EVENT_KEY}`,EVENT_UPDATE=`update${EVENT_KEY}`,EVENT_COMPLETE=`complete${EVENT_KEY}`,{state:i,actions:s}=e(NAMESPACE,{state:{get countTo(){let{from:p=i.from,value:T=p,comma:u=i.comma,decimals:c=i.decimals}=t(),A=T.toFixed(c);return u&&(A=parseFloat(A).toLocaleString()),A},get loops(){let{refresh:N=i.refresh,speed:v=i.speed}=t();return Math.ceil(v/N)},get increment(){let{from:d,to:g}=t();return parseFloat((parseFloat(g)-parseFloat(d))/i.loops)}},actions:{start(){let e=t(),{ref:r}=o(),{refresh:l=i.refresh,from:a,to:p}=e,T=n.trigger(r,EVENT_START,{from:a,to:p});!T.defaultPrevented&&(s.stop(),e.value=parseFloat(a),e.loopCount=0,e.interval=setInterval(E(s.update),l))},stop(){let e=t();e.interval&&clearInterval(e.interval)},update(){let e=t(),{from:r}=e;e.value=(e.value||parseFloat(r))+i.increment,e.loopCount=(e.loopCount||0)+1;let{onUpdate:E,onComplete:a,...s}={...i,...e},{ref:p}=o(),T={...s,current:e.value};n.trigger(p,EVENT_UPDATE,T),l(E,[p,T]),e.loopCount>=i.loops&&(clearInterval(e.interval),e.value=s.to,n.trigger(p,EVENT_COMPLETE,T),l(a,[p,T]))},observe(){let{ref:e}=o(),{offset:r=i.offset}=t(),l={rootMargin:`0px 0px ${parseFloat(r).toString()}px 0px`,threshold:1},a=new IntersectionObserver(E((e,t)=>e.forEach(({isIntersecting:e})=>{e&&(s.start(),t.disconnect())})),l);a.observe(e)}},callbacks:{validateConfig:()=>a(NAME,{...i,...t()},r(NAMESPACE))}});