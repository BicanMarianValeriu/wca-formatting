import{store as t,getContext as e,getElement as o,getConfig as E,withScope as r}from"@wordpress/interactivity";let{hooks:{applyFilters:n}}=wp,{fn:{execute:i,validateConfig:l},Events:g}=wecodeart,NAME="counter",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_START=`start${EVENT_KEY}`,EVENT_UPDATE=`update${EVENT_KEY}`,EVENT_COMPLETE=`complete${EVENT_KEY}`,{state:a,actions:T,callbacks:p}=t(NAMESPACE,{state:{get countTo(){let{decimals:u,comma:c,from:A}=p.getConfig(),{value:C=A}=e(),s=C.toFixed(u);return c&&(s=parseFloat(s).toLocaleString()),s},get loops(){let{refresh:N,speed:f}=p.getConfig();return Math.ceil(f/N)},get increment(){let{from:v,to:d}=p.getConfig();return parseFloat((parseFloat(d)-parseFloat(v))/a.loops)}},actions:{start(){let{ref:t}=o(),{refresh:E,from:n,to:i}=p.getConfig(),l=e(),a=g.trigger(t,EVENT_START,{from:n,to:i});!a.defaultPrevented&&(T.stop(),l.value=parseFloat(n),l.loopCount=0,l.interval=setInterval(r(T.update),E))},stop(){let t=e();t.interval&&clearInterval(t.interval)},update(){let t=e(),{from:E}=p.getConfig();t.value=(t.value||parseFloat(E))+a.increment,t.loopCount=(t.loopCount||0)+1;let{onUpdate:r,onComplete:n,...l}=p.getConfig(),{ref:T}=o(),u={...l,current:t.value};g.trigger(T,EVENT_UPDATE,u),i(r,[T,u]),t.loopCount>=a.loops&&(clearInterval(t.interval),t.value=l.to,g.trigger(T,EVENT_COMPLETE,u),i(n,[T,u]))},observe(){let{ref:t}=o(),{offset:e}=p.getConfig(),E={rootMargin:`0px 0px ${parseFloat(e).toString()}px 0px`,threshold:1},n=new IntersectionObserver(r((t,e)=>t.forEach(({isIntersecting:t})=>{t&&(T.start(),e.disconnect())})),E);n.observe(t)}},callbacks:{getConfig(){let t=e(),o={...a,...t};return n("wecodeart.interactive.config",o,NAME)},validateConfig:()=>l(NAME,p.getConfig(),E(NAMESPACE))}});