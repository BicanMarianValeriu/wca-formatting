import{store,getContext,getElement,getConfig,withScope}from"@wordpress/interactivity";const{fn:{execute:execute,validateConfig:validateConfig},Events:Events}=wecodeart,NAME="counter",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_START=`start${EVENT_KEY}`,EVENT_UPDATE=`update${EVENT_KEY}`,EVENT_COMPLETE=`complete${EVENT_KEY}`,{state:state,actions:actions}=store(NAMESPACE,{state:{get countTo(){const{value:t,from:e=0,comma:o=!1,decimals:a=0}=getContext();let r=t||e;return r=r.toFixed(a),o&&(r=parseFloat(r).toLocaleString()),r},get loops(){const{refresh:t=100,speed:e=1e3}=getContext();return Math.ceil(e/t)},get increment(){const{from:t=0,to:e=0}=getContext();return parseFloat((parseFloat(e)-parseFloat(t))/state.loops)}},actions:{start(){const t=getContext(),{ref:e}=getElement(),{refresh:o=state.refresh,from:a=state.from,to:r=state.to}=t;Events.trigger(e,EVENT_START,{from:a,to:r}).defaultPrevented||(actions.stop(),t.value=parseFloat(a),t.loopCount=0,t.interval=setInterval(withScope(actions.update),o))},stop(){const t=getContext();t.interval&&clearInterval(t.interval)},update(){const t=getContext(),{from:e=state.from}=t;t.value=(t.value||parseFloat(e))+state.increment,t.loopCount=(t.loopCount||0)+1;const{onUpdate:o,onComplete:a,...r}={...state,...t},{ref:n}=getElement(),s={...r,current:t.value};Events.trigger(n,EVENT_UPDATE,s),execute(o,[n,s]),t.loopCount>=state.loops&&(clearInterval(t.interval),t.value=r.to,Events.trigger(n,EVENT_COMPLETE,s),execute(a,[n,s]))},observe(){const{ref:t}=getElement(),{offset:e=state.offset}=getContext(),o={rootMargin:`0px 0px ${parseFloat(e).toString()}px 0px`,threshold:1};new IntersectionObserver(withScope(((e,o)=>e.forEach((({isIntersecting:e})=>{e&&(actions.start(),setTimeout((()=>o.unobserve(t)),100))})))),o).observe(t)}},callbacks:{validateConfig:()=>validateConfig(NAME,{...state,...getContext()},getConfig(NAMESPACE))}});