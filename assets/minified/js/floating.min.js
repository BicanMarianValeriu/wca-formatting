import{store as e,getContext as t,getElement as n,getConfig as o,withScope as i}from"@wordpress/interactivity";import{computePosition as s,autoUpdate as r,offset as a,flip as l,shift as c,arrow as d,inline as g}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.9/+esm";if(void 0===s)throw new TypeError("WeCodeArt's tooltips require Floating UI (https://floating-ui.com/)");const{fn:{execute:p,executeAfterTransition:u,getElement:m,findShadowRoot:f,validateConfig:h,isRTL:w,noop:v},Events:T,Template:b}=wecodeart,y="floating",E=`wecodeart/${y}`,P=`.${`wp.${y}`}`,A=`show${P}`,x=`shown${P}`,C=`inserted${P}`,$=`hide${P}`,F=`hidden${P}`,L="hover",D="focus",H=".wp-floating__body",O={AUTO:"auto",TOP:"top",RIGHT:w()?"left":"right",BOTTOM:"bottom",LEFT:w()?"right":"left"},{state:k,actions:B,callbacks:I}=e(E,{state:{get getContent(){const{content:e=k.content}=t();return I.resolvePossibleFunction(e)},get getTitle(){const{title:e=k.title}=t();return I.resolvePossibleFunction(e)},get getDelay(){let{delay:e=k.delay}=t();switch(e="string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):[e],e.length){case 1:e={show:e[0],hide:e[0]};break;case 2:e={show:e[0],hide:e[1]}}return e},get getOffset(){let{offset:e=k.offset}=t();switch("string"==typeof e&&(e=e.split(",").map((e=>Number.parseInt(e,10)))),e.length){case 1:e={mainAxis:e[0]};break;case 2:e={mainAxis:e[0],crossAxis:e[1]};break;case 3:e={mainAxis:e[0],crossAxis:e[1],alignmentAxis:e[2]}}return e},get isWithContent(){return Boolean(k.getTitle||k.getContent)},get isWithActiveTrigger(){const{activeTrigger:e={}}=t();return Object.values(e).includes(!0)},get isAnimated(){const{animation:e=k.animation}=t();return e}},actions:{enable(){t().isEnabled=!0},disable(){t().isEnabled=!1},toggleEnabled(){const e=t();e.isEnabled=!e.isEnabled},toggle:e=>{const{isEnabled:t}=k;if(!t)return;I.getTipElement().classList.contains("show")?B.leave(e):B.enter(e)},show:e=>{if(I.getTipElement().classList.contains("show"))return;const{ref:o}=n();if("none"===o.style.display)throw new Error("Please use show on visible elements");const{isEnabled:s}=k;if(!k.isWithContent||!s)return;const a=T.trigger(o,A),l=(f(o)||o.ownerDocument.documentElement).contains(o);if(a.defaultPrevented||!l)return;I.disposePopper();const c=I.getTipElement(),d=t();if(o.setAttribute("aria-describedby",c.getAttribute("id")),!o.ownerDocument.documentElement.contains(c)){(d.container?m(d.container):document.body).append(c),d.cleanup=r(o,c,i(I.createPopper)),T.trigger(o,C)}if(c.classList.add("show"),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))T.on(e,"mouseover",v);const g=i((()=>{T.trigger(o,x),!1===d.isHovered&&B.leave(e),d.isHovered=!1}));u(g,c,k.isAnimated)},hide:()=>{if(!I.getTipElement().classList.contains("show"))return;const{ref:e}=n();if(T.trigger(e,$).defaultPrevented)return;const o=I.getTipElement();if(o.classList.remove("show"),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))T.off(e,"mouseover",v);const s=t();s.activeTrigger.click=!1,s.activeTrigger[D]=!1,s.activeTrigger[L]=!1,s.isHovered=null;const r=i((()=>{k.isWithActiveTrigger||(s.isHovered||I.disposePopper(),e.removeAttribute("aria-describedby"),T.trigger(e,F))}));u(r,o,k.isAnimated)},enter:e=>{const{type:n}=e,o=t(),i=I.getTipElement().classList.contains("show");if(o.activeTrigger={},o.activeTrigger["focusin"===n?D:L]=!0,i||o.isHovered)return void(o.isHovered=!0);o.isHovered=!0;const{show:s}=k.getDelay;I.withTimeout((()=>B.show(e)),s)},leave:e=>{const{type:n,target:o,relatedTarget:i}=e,s=t();if(s.activeTrigger["focusout"===n?D:L]=o&&o.contains(i),k.isWithActiveTrigger)return;s.isHovered=!1;const{hide:r}=k.getDelay;I.withTimeout((()=>B.hide(e)),r)},setContent(e){t().newContent=e;I.getTipElement().classList.contains("show")&&(I.disposePopper(),B.show())}},callbacks:{getTemplateFactory:e=>{const n=t();if(n.templateFactory)n.templateFactory.changeContent(e);else{const t={...k,...n};n.templateFactory=new b({...t,content:e,extraClass:I.resolvePossibleFunction(t.className)})}return n.templateFactory},getTipElement:()=>{const e=t();return e.tip||(e.tip=I.createTipElement(e.newContent||I.getContentForTemplate())),e.tip},getContentForTemplate:()=>{const{plugin:e}=t();let n={};if("popover"===e)n={".wp-floating__head":k.getTitle,[H]:k.getContent};else n={[H]:k.getTitle};return n},createTipElement:e=>{const n=I.getTemplateFactory(e).toHtml();n.classList.remove("fade","show"),n.classList.add(`wp-${y}--auto`);const{plugin:o="tooltip"}=t();n.classList.add(`wp-${y}--${o}`);const i=I.getUID().toString();return n.setAttribute("id",i),k.isAnimated&&n.classList.add("fade"),n},createPopper:()=>{const{ref:e}=n(),o=I.getTipElement(),{placement:i,fallbackPlacements:r,shift:p}={...k,...t()},u=O[I.resolvePossibleFunction(i).toUpperCase()],m=o.querySelector(".wp-floating__arrow"),f={name:"setPlacement",fn:({placement:e})=>(o.setAttribute("data-placement",e),{})};return s(e,o,{placement:u,middleware:[a({...k.getOffset}),l({fallbackPlacements:r}),!!p&&c({...p}),!!m&&d({element:m}),g(),f].filter(Boolean)}).then((({x:e,y:t,middlewareData:{arrow:n}={}})=>{if(n){const{x:e,y:t}=n;Object.assign(m.style,{left:null!=e?`${e}px`:"",top:null!=t?`${t}px`:""})}Object.assign(o.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${I.roundByDPR(e)}px,${I.roundByDPR(t)}px,0)`})}))},disposePopper:()=>{const e=t();e.tip&&(e.tip.remove(),e.tip=null),e.cleanup&&(e.cleanup(),e.cleanup=null)},validateConfig:()=>h(y,{...k,...t()},o(E)),getUID:()=>{let e=`wp-${y}-`;do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e},resolvePossibleFunction:e=>{const{ref:t}=n();return p(e,[t])},roundByDPR:e=>{const t=window.devicePixelRatio||1;return Math.round(e*t)/t},withTimeout:(e,n)=>{const o=t();clearTimeout(o.timeout),o.timeout=setTimeout(i(e),n)}}});
