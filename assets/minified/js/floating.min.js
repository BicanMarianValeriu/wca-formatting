import{store as e,getContext as t,getElement as i,getConfig as n,withScope as o}from"@wordpress/interactivity";import{computePosition as r,autoUpdate as l,detectOverflow as s,offset as a,flip as g,shift as E,arrow as c,inline as d}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.3/+esm";if(void 0===r)throw TypeError("WeCodeArt's tooltips require Floating UI (https://floating-ui.com/)");let{hooks:{applyFilters:p}}=wp,{fn:{execute:T,executeAfterTransition:u,getElement:getDOMElement,findShadowRoot:f,validateConfig:m,isRTL:h,noop:v},Events:w,Template:A}=wecodeart,NAME="floating",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_INSERTED=`inserted${EVENT_KEY}`,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,TRIGGER_HOVER="hover",TRIGGER_FOCUS="focus",TRIGGER_CLICK="click",TRIGGER_MANUAL="manual",SELECTOR_TOOLTIP_ARROW=".wp-floating__arrow",SELECTOR_TOOLTIP_HEAD=".wp-floating__head",SELECTOR_TOOLTIP_BODY=".wp-floating__body",AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:h()?"left":"right",BOTTOM:"bottom",LEFT:h()?"right":"left"},{state:C,actions:O,callbacks:R}=e(NAMESPACE,{state:{get getContent(){let{content:N}=R.getConfig();return R.resolvePossibleFunction(N)},get getTitle(){let{title:b}=R.getConfig();return R.resolvePossibleFunction(b)},get isWithContent(){return Boolean(C.getTitle||C.getContent)},get isWithActiveTrigger(){let{activeTrigger:y={}}=R.getConfig();return Object.values(y).includes(!0)},get isAnimated(){let{animation:I,tip:P}=R.getConfig();return I||P&&P.classList.contains("fade")},get isShown(){let{tip:H}=R.getConfig();return H&&H.classList.contains("show")}},actions:{enable(){let e=t();e.isEnabled=!0},disable(){let e=t();e.isEnabled=!1},toggleEnabled(){let e=t();e.isEnabled=!e.isEnabled},toggle(e){let t=R.getConfig(),{isEnabled:i}=t;if(i){if(t.activeTrigger={},t.activeTrigger.click=!!t.activeTrigger.click,C.isShown){O.leave(e);return}O.enter(e)}},show(e){let{ref:n}=i();if("none"===n.style.display)throw Error("Please use show on visible elements");let r=R.getConfig(),{isEnabled:s}=r;if(!(C.isWithContent&&s))return;let a=w.trigger(n,EVENT_SHOW),g=f(n),E=(g||n.ownerDocument.documentElement).contains(n);if(a.defaultPrevented||!E)return;R.disposePopper();let c=R.getTipElement(),d=t();if(n.setAttribute("aria-describedby",c.getAttribute("id")),!n.ownerDocument.documentElement.contains(c)){let{container:p}=r;p.append(c),d.cleanup=l(n,c,o(R.createPopper)),w.trigger(n,EVENT_INSERTED)}if(c.classList.add("show"),"ontouchstart"in document.documentElement)for(let T of[].concat(...document.body.children))w.on(T,"mouseover",v);let m=o(()=>{w.trigger(n,EVENT_SHOWN),!1===d.isHovered&&O.leave(e),d.isHovered=!1});u(m,c,C.isAnimated)},hide(){if(!C.isShown)return;let{ref:e}=i(),n=w.trigger(e,EVENT_HIDE);if(n.defaultPrevented)return;let r=R.getTipElement();if(r.classList.remove("show"),"ontouchstart"in document.documentElement)for(let l of[].concat(...document.body.children))w.off(l,"mouseover",v);let s=t();s.activeTrigger.click=!1,s.activeTrigger[TRIGGER_FOCUS]=!1,s.activeTrigger[TRIGGER_HOVER]=!1,s.isHovered=null;let a=o(()=>{!C.isWithActiveTrigger&&(s.isHovered||R.disposePopper(),e.removeAttribute("aria-describedby"),w.trigger(e,EVENT_HIDDEN))});u(a,r,C.isAnimated)},enter(e){let{type:i}=e,n=t();if(n.activeTrigger={},n.activeTrigger["focusin"===i?TRIGGER_FOCUS:TRIGGER_HOVER]=!0,C.isShown||n.isHovered){n.isHovered=!0;return}n.isHovered=!0;let{delay:{show:o}}=R.getConfig();R.withTimeout(()=>n.isHovered&&O.show(e),o)},leave(e){let{type:i,target:n,relatedTarget:o}=e,r=t();if(r.activeTrigger["focusout"===i?TRIGGER_FOCUS:TRIGGER_HOVER]=n&&n.contains(o),C.isWithActiveTrigger)return;r.isHovered=!1;let{delay:{hide:l}}=R.getConfig();R.withTimeout(()=>!r.isHovered&&O.hide(e),l)},setContent(e){let i=t();i.newContent=e,C.isShown&&(R.disposePopper(),O.show())}},callbacks:{getTemplateFactory(e){let i=t();if(i.templateFactory)i.templateFactory.changeContent(e);else{let n=R.getConfig();i.templateFactory=new A({...n,content:e,extraClass:R.resolvePossibleFunction(n.className)})}return i.templateFactory},getTipElement(){let e=t();return e.tip||(e.tip=R.createTipElement(e.newContent||R.getContentForTemplate())),e.tip},getContentForTemplate(){let{plugin:e}=R.getConfig(),t={};return t="popover"===e?{".wp-floating__head":C.getTitle,[SELECTOR_TOOLTIP_BODY]:C.getContent}:{[SELECTOR_TOOLTIP_BODY]:C.getTitle}},createTipElement(e){let t=R.getTemplateFactory(e).toHtml();t.classList.remove("fade","show"),t.classList.add(`wp-${NAME}--auto`);let{plugin:i="tooltip"}=R.getConfig();t.classList.add(`wp-${NAME}--${i}`);let n=R.getUID().toString();return t.setAttribute("id",n),C.isAnimated&&t.classList.add("fade"),t},createPopper(){let{ref:e}=i(),t=R.getTipElement(),{placement:n,fallbackPlacements:o,boundary:l,offset:p}=R.getConfig(),T=AttachmentMap[R.resolvePossibleFunction(n).toUpperCase()],u=t.querySelector(".wp-floating__arrow");return r(e,t,{placement:T,middleware:[a({...p}),g({fallbackPlacements:o}),E({crossAxis:!0}),!!u&&c({element:u}),d(),{name:"preventOverflow",fn:async e=>(await s(e,{boundary:l}),{})},{name:"setPlacement",fn:({placement:e})=>(t.setAttribute("data-placement",e),{})},].filter(Boolean)}).then(({x:e,y:i,middlewareData:{arrow:n}={}})=>{if(n){let{x:o,y:r}=n;Object.assign(u.style,{left:null!=o?`${o}px`:"",top:null!=r?`${r}px`:""})}Object.assign(t.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${R.roundByDPR(e)}px,${R.roundByDPR(i)}px,0)`})})},disposePopper(){let e=t();e.tip&&(e.tip.remove(),e.tip=null),e.cleanup&&(e.cleanup(),e.cleanup=null)},getConfig(){let e=t(),i={...C,...e};i.container=e.container?getDOMElement(e.container):document.body;let{offset:n,delay:o}=i;switch("string"==typeof n&&(n=n.split(",").map(e=>Number.parseInt(e,10))),n.length){case 1:i.offset={mainAxis:n[0]};break;case 2:i.offset={mainAxis:n[0],crossAxis:n[1]};break;case 3:i.offset={mainAxis:n[0],crossAxis:n[1],alignmentAxis:n[2]}}switch("string"==typeof o&&(o=o.split(",").map(e=>Number.parseInt(e,10))),o.length){case 1:i.delay={show:o[0],hide:o[0]};break;case 2:i.delay={show:o[0],hide:o[1]}}return p("wecodeart.interactive.config",i,NAME)},validateConfig:()=>m(NAME,R.getConfig(),n(NAMESPACE)),getUID(){let e=`wp-${NAME}-`;do e+=Math.floor(1e6*Math.random());while(document.getElementById(e));return e},resolvePossibleFunction(e){let{ref:t}=i();return T(e,[t])},roundByDPR(e){let t=window.devicePixelRatio||1;return Math.round(e*t)/t},withTimeout(e,i){let n=t();clearTimeout(n.timeout),n.timeout=setTimeout(o(e),i)}}});