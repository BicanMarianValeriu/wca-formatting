import{store,getContext,getElement,getConfig,withScope}from"@wordpress/interactivity";const{fn:{validateConfig,executeAfterTransition},Events}=wecodeart,NAME="rotator",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_CHANGE=`beforeChange${EVENT_KEY}`,EVENT_CHANGED=`afterChange${EVENT_KEY}`,{state,actions}=store(NAMESPACE,{state:{get initialString(){const{ref:t}=getElement();return t.firstChild},get nextString(){const{ref:t}=getElement(),{activeString:e}=getContext(),i=e||state.initialString;return i!==t.lastElementChild?i.nextElementSibling:t.firstElementChild},get prevString(){const{ref:t}=getElement(),{activeString:e}=getContext(),i=e||state.initialString;return i!==t.firstElementChild?i.previousElementSibling:t.lastElementChild}},actions:{init(){const t=getContext(),{changeDelay:e,letterDelay:i}={...state,...t};clearTimeout(t.timeout),t.timeout=setTimeout(withScope((()=>t.activeString=state.nextString)),e),i!==state.letterDelay&&getElement().ref.style.setProperty("--wp--letter--delay",`${i}ms`)},enable:()=>actions.init(),dispose:()=>clearTimeout(getContext().timeout),changeString(){const{ref:t}=getElement(),{activeString:e}=getContext();if(e){if(Events.trigger(t,EVENT_CHANGE,{prevString:state.prevString,nextString:e}).defaultPrevented)return;t.style.width=`${e.offsetWidth}px`,t.classList.remove("changed"),t.classList.add("changing"),state.prevString.classList.add("inactive"),state.prevString.classList.remove("active"),e.classList.remove("inactive"),e.classList.add("active");const i=withScope((()=>{Events.trigger(t,EVENT_CHANGED,{activeString:e,prevString:state.prevString}),t.classList.remove("changing"),t.classList.add("changed"),actions.init()}));executeAfterTransition(i,e,!0)}}},callbacks:{wrapLetters(){const{ref:t}=getElement(),e=t.querySelectorAll("span");t.classList.add("letters"),e.forEach((t=>{const e=t.innerText.split("");for(let t in e){const i=" "==e[t]?"&nbsp;":e[t];e[t]=`<i style="--index:${t}">${i}</i>`}t.innerHTML=e.join(""),t.style.setProperty("--wp--letters",e.length)}))},validateConfig:()=>validateConfig(NAME,{...state,...getContext()},getConfig(NAMESPACE))}});