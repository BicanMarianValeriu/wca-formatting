import{store as t,getContext as e,getElement as i,getConfig as r,withScope as n}from"@wordpress/interactivity";let{hooks:{applyFilters:l}}=wp,{fn:{validateConfig:s,executeAfterTransition:a},Events:g}=wecodeart,NAME="rotator",NAMESPACE=`wecodeart/${NAME}`,DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_CHANGE=`beforeChange${EVENT_KEY}`,EVENT_CHANGED=`afterChange${EVENT_KEY}`,{state:E,actions:o,callbacks:c}=t(NAMESPACE,{state:{get initialString(){let{ref:d}=i();return d.firstChild},get nextString(){let{ref:v}=i(),S=e(),p=S.activeString||E.initialString;return p!==v.lastElementChild?p.nextElementSibling:v.firstElementChild},get prevString(){let{ref:f}=i(),A=e(),N=A.activeString||E.initialString;return N!==f.firstElementChild?N.previousElementSibling:f.lastElementChild}},actions:{init(){let t=e(),{changeDelay:r,letterDelay:l}=c.getConfig();clearTimeout(t.timeout),t.timeout=setTimeout(n(()=>t.activeString=E.nextString),r),l!==E.letterDelay&&i().ref.style.setProperty("--wp--letter--delay",`${l}ms`)},enable:()=>o.init(),dispose:()=>clearTimeout(e().timeout),changeString(){let{ref:t}=i(),{activeString:r}=e();if(r){let l=g.trigger(t,EVENT_CHANGE,{prevString:E.prevString,nextString:r});if(l.defaultPrevented)return;t.style.width=`${r.offsetWidth}px`,t.classList.remove("changed"),t.classList.add("changing"),E.prevString.classList.add("inactive"),E.prevString.classList.remove("active"),r.classList.remove("inactive"),r.classList.add("active");let s=n(()=>{g.trigger(t,EVENT_CHANGED,{activeString:r,prevString:E.prevString}),t.classList.remove("changing"),t.classList.add("changed"),o.init()});a(s,r,!0)}}},callbacks:{wrapLetters(){let{ref:t}=i(),e=t.querySelectorAll("span");t.classList.add("letters"),e.forEach(t=>{let e=t.innerText.split("");for(let i in e){let r=" "==e[i]?"&nbsp;":e[i];e[i]=`<i style="--index:${i}">${r}</i>`}t.innerHTML=e.join(""),t.style.setProperty("--wp--letters",e.length)})},getConfig(){let t=e(),i={...E,...t};return l("wecodeart.interactive.config",i,NAME)},validateConfig:()=>s(NAME,c.getConfig(),r(NAMESPACE))}});