import{store as e,getContext as t,getElement as i,getConfig as o,withScope as n}from"@wordpress/interactivity";import{computePosition as r,autoUpdate as l,detectOverflow as a,offset as s,flip as c,shift as g,arrow as d,inline as p}from"//cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.3/+esm";if(void 0===r)throw TypeError("WeCodeArt's tooltips require Floating UI (https://floating-ui.com/)");let{hooks:{applyFilters:u}}=wp,{fn:{execute:E,executeAfterTransition:f,getElement:getDOMElement,isElement:m,isRTL:T,toType:h=object=>null==object?`${object}`:Object.prototype.toString.call(object).match(/\s([a-z]+)/i)[1].toLowerCase()},Events:b,Template:w}=wecodeart,NAME="tooltip",DATA_KEY=`wp.${NAME}`,EVENT_KEY=`.${DATA_KEY}`,EVENT_SHOW=`show${EVENT_KEY}`,EVENT_SHOWN=`shown${EVENT_KEY}`,EVENT_INSERTED=`inserted${EVENT_KEY}`,EVENT_HIDE=`hide${EVENT_KEY}`,EVENT_HIDDEN=`hidden${EVENT_KEY}`,TRIGGER_HOVER="hover",TRIGGER_FOCUS="focus",TRIGGER_CLICK="click",TRIGGER_MANUAL="manual",SELECTOR_TOOLTIP_ARROW=".wp-tooltip__arrow",SELECTOR_TOOLTIP_INNER=".wp-tooltip__inner",AttachmentMap={AUTO:"auto",TOP:"top",RIGHT:T()?"left":"right",BOTTOM:"bottom",LEFT:T()?"right":"left"},findShadowRoot=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){let t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?findShadowRoot(e.parentNode):null},noop=()=>{},DefaultType={isEnabled:"(boolean|function)",boundary:"(string|element)",placement:"(string|function)",className:"(string|function)",fallbackPlacements:"array",offset:"(array|object|string|function)",delay:"(number|object)",animation:"boolean",container:"(string|element|boolean|null)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"},{state:v,actions:R,callbacks:y}=e("wecodeart/tooltip",{state:{get getTitle(){let{title:N}=y.getConfig();return y.resolvePossibleFunction(N)},get isWithContent(){return Boolean(v.getTitle)},get isWithActiveTrigger(){let{activeTrigger:A={}}=y.getConfig();return Object.values(A).includes(!0)},get isAnimated(){let{animation:C,tip:O}=y.getConfig();return C||O&&O.classList.contains("fade")},get isShown(){let{tip:I}=y.getConfig();return I&&I.classList.contains("show")}},actions:{enable(){let e=t();e.isEnabled=!0},disable(){let e=t();e.isEnabled=!1},toggleEnabled(){let e=t();e.isEnabled=!e.isEnabled},toggle(e){let t=y.getConfig(),{isEnabled:i}=t;if(i){if(t.activeTrigger={},t.activeTrigger.click=!!t.activeTrigger.click,v.isShown){R.leave(e);return}R.enter(e)}},show(e){let{ref:o}=i();if("none"===o.style.display)throw Error("Please use show on visible elements");let r=y.getConfig(),{isEnabled:a}=r;if(!(v.isWithContent&&a))return;let s=b.trigger(o,EVENT_SHOW),c=findShadowRoot(o),g=(c||o.ownerDocument.documentElement).contains(o);if(s.defaultPrevented||!g)return;y.disposePopper();let d=y.getTipElement(),p=t();if(o.setAttribute("aria-describedby",d.getAttribute("id")),!o.ownerDocument.documentElement.contains(d)){let{container:u}=r;u.append(d),p.cleanup=l(o,d,n(y.createPopper)),b.trigger(o,EVENT_INSERTED)}if(d.classList.add("show"),"ontouchstart"in document.documentElement)for(let E of[].concat(...document.body.children))b.on(E,"mouseover",noop);let m=n(()=>{b.trigger(o,EVENT_SHOWN),!1===p.isHovered&&R.leave(e),p.isHovered=!1});f(m,d,v.isAnimated)},hide(){if(!v.isShown)return;let{ref:e}=i(),o=b.trigger(e,EVENT_HIDE);if(o.defaultPrevented)return;let r=y.getTipElement();if(r.classList.remove("show"),"ontouchstart"in document.documentElement)for(let l of[].concat(...document.body.children))b.off(l,"mouseover",noop);let a=t();a.activeTrigger.click=!1,a.activeTrigger[TRIGGER_FOCUS]=!1,a.activeTrigger[TRIGGER_HOVER]=!1,a.isHovered=null;let s=n(()=>{!v.isWithActiveTrigger&&(a.isHovered||y.disposePopper(),e.removeAttribute("aria-describedby"),b.trigger(e,EVENT_HIDDEN))});f(s,r,v.isAnimated)},enter(e){let{type:i}=e,o=t();if(o.activeTrigger={},o.activeTrigger["focusin"===i?TRIGGER_FOCUS:TRIGGER_HOVER]=!0,v.isShown||o.isHovered){o.isHovered=!0;return}o.isHovered=!0;let{delay:{show:n}}=y.getConfig();y.withTimeout(()=>o.isHovered&&R.show(e),n)},leave(e){let{type:i,target:o,relatedTarget:n}=e,r=t();if(r.activeTrigger["focusout"===i?TRIGGER_FOCUS:TRIGGER_HOVER]=o&&o.contains(n),v.isWithActiveTrigger)return;r.isHovered=!1;let{delay:{hide:l}}=y.getConfig();y.withTimeout(()=>!r.isHovered&&R.hide(e),l)},setContent(e){let i=t();i.newContent=e,v.isShown&&(y.disposePopper(),R.show())}},callbacks:{getTemplateFactory(e){let t=y.getConfig();return t.templateFactory?t.templateFactory.changeContent(e):t.templateFactory=new w({...t,content:e,extraClass:y.resolvePossibleFunction(t.className)}),t.templateFactory},getTipElement(){let e=t();return e.tip||(e.tip=y.createTipElement(e.newContent||{".wp-tooltip__inner":v.getTitle})),e.tip},createTipElement(e){let t=y.getTemplateFactory(e).toHtml();t.classList.remove("fade","show"),t.classList.add(`wp-${NAME}--auto`);let i=y.getUID().toString();return t.setAttribute("id",i),v.isAnimated&&t.classList.add("fade"),t},createPopper(){let{ref:e}=i(),t=y.getTipElement(),{placement:o,fallbackPlacements:n,boundary:l,offset:u}=y.getConfig(),E=AttachmentMap[y.resolvePossibleFunction(o).toUpperCase()],f=t.querySelector(".wp-tooltip__arrow");return r(e,t,{placement:E,middleware:[s({...u}),c({fallbackPlacements:n}),g({crossAxis:!0}),d({element:f}),p(),{name:"preventOverflow",fn:async e=>(await a(e,{boundary:l}),{})},{name:"setPlacement",fn:({placement:e})=>(t.setAttribute("data-placement",e),{})},].filter(Boolean)}).then(({x:e,y:i,middlewareData:{arrow:o}={}})=>{if(o){let{x:n,y:r}=o;Object.assign(f.style,{left:null!=n?`${n}px`:"",top:null!=r?`${r}px`:""})}Object.assign(t.style,{position:"absolute",inset:"auto",margin:"0",top:"0",left:"0",transform:`translate3d(${y.roundByDPR(e)}px,${y.roundByDPR(i)}px,0)`})})},disposePopper(){let e=t();e.tip&&(e.tip.remove(),e.tip=null),e.cleanup&&(e.cleanup(),e.cleanup=null)},getConfig(){let e=t(),i={...o(),...e};i.container=e.container?getDOMElement(e.container):document.body;let{offset:n,delay:r}=i;switch("string"==typeof n&&(n=n.split(",").map(e=>Number.parseInt(e,10))),n.length){case 1:i.offset={mainAxis:n[0]};break;case 2:i.offset={mainAxis:n[0],crossAxis:n[1]};break;case 3:i.offset={mainAxis:n[0],crossAxis:n[1],alignmentAxis:n[2]}}switch("string"==typeof r&&(r=r.split(",").map(e=>Number.parseInt(e,10))),r.length){case 1:i.delay={show:r[0],hide:r[0]};break;case 2:i.delay={show:r[0],hide:r[1]}}return u("wecodeart/interactive/config",i,NAME)},validateConfig(){let e=y.getConfig();for(let[t,i]of Object.entries(DefaultType)){let o=e[t],n=m(o)?"element":h(o);if(!RegExp(i).test(n))throw TypeError(`${NAME.toUpperCase()}: Option "${t}" provided type "${n}" but expected type "${i}".`)}},getUID(){let e=`wp-${NAME}-`;do e+=Math.floor(1e6*Math.random());while(document.getElementById(e));return e},resolvePossibleFunction(e){let{ref:t}=i();return E(e,[t])},roundByDPR(e){let t=window.devicePixelRatio||1;return Math.round(e*t)/t},withTimeout(e,i){let o=t();clearTimeout(o.timeout),o.timeout=setTimeout(n(e),i)}}});